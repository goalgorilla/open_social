!function(e){var t=Drupal.tableDrag.prototype;Drupal.tableDrag=function(t,n){var r=this,a=e(t);this.$table=e(t),this.table=t,this.tableSettings=n,this.dragObject=null,this.rowObject=null,this.oldRowElement=null,this.oldY=0,this.changed=!1,this.maxDepth=0,this.rtl="rtl"===e(this.table).css("direction")?-1:1,this.striping=1===e(this.table).data("striping"),this.scrollSettings={amount:4,interval:50,trigger:70},this.scrollInterval=null,this.scrollY=0,this.windowHeight=0,this.indentEnabled=!1;for(var o in n)if(n.hasOwnProperty(o))for(var i in n[o])n[o].hasOwnProperty(i)&&("parent"===n[o][i].relationship&&(this.indentEnabled=!0),n[o][i].limit>0&&(this.maxDepth=n[o][i].limit));if(this.indentEnabled){this.indentCount=1;var l=Drupal.theme("tableDragIndentation"),s=e("<tr/>").addClass("draggable").appendTo(t),d=e("<td/>").appendTo(s).prepend(l).prepend(l).find(".js-indentation");this.indentAmount=d.get(1).offsetLeft-d.get(0).offsetLeft,s.remove()}a.find("> tr.draggable, > tbody > tr.draggable").each(function(){r.makeDraggable(this)});var g=e(Drupal.theme("btn-sm",{class:["tabledrag-toggle-weight","btn-flat","pull-right","margin-bottom-l"],title:Drupal.t("Re-order rows by numerical weight instead of dragging."),"data-toggle":"tooltip"}));g.on("click",e.proxy(function(e){e.preventDefault(),this.toggleColumns()},this)).wrap('<div class="tabledrag-toggle-weight-wrapper"></div>').parent(),a.before(g),r.initColumns(),e(document).on("touchmove",function(e){return r.dragRow(e.originalEvent.touches[0],r)}),e(document).on("touchend",function(e){return r.dropRow(e.originalEvent.touches[0],r)}),e(document).on("mousemove pointermove",function(e){return r.dragRow(e,r)}),e(document).on("mouseup pointerup",function(e){return r.dropRow(e,r)}),e(window).on("storage",e.proxy(function(e){"Drupal.tableDrag.showWeight"===e.originalEvent.key&&(showWeight=JSON.parse(e.originalEvent.newValue),this.displayColumns(showWeight))},this))},Drupal.tableDrag.prototype=t,Drupal.tableDrag.prototype.makeDraggable=function(t){var n=this,r=e(t);r.find("td:first-of-type").find("a").addClass("menu-item__link");var a=e('<a href="#" class="tabledrag-handle icon-before"/>'),o=r.find("td:first-of-type").find(".js-indentation").eq(-1);o.length?(o.after(a),n.indentCount=Math.max(r.find(".js-indentation").length,n.indentCount)):r.find("td").eq(0).prepend(a),a.attr("title",Drupal.t("Drag to re-order")).attr("data-toggle","tooltip").attr("data-icon-type","open_with").append(Drupal.theme("bootstrapIcon","move")),a.on("mousedown touchstart pointerdown",function(e){e.preventDefault(),"touchstart"===e.originalEvent.type&&(e=e.originalEvent.touches[0]),n.dragStart(e,n,t)}),a.on("click",function(e){e.preventDefault()}),a.on("focus",function(){n.safeBlur=!0}),a.on("blur",function(e){n.rowObject&&n.safeBlur&&n.dropRow(e,n)}),a.on("keydown",function(r){9===r.keyCode||n.rowObject||(n.rowObject=new n.row(t,"keyboard",n.indentEnabled,n.maxDepth,!0));var o,i=!1;switch(r.keyCode){case 37:case 63234:i=!0,n.rowObject.indent(-1*n.rtl);break;case 38:case 63232:for(var l=e(n.rowObject.element).prev("tr:first-of-type"),s=l.get(0);s&&l.is(":hidden");)s=(l=e(s).prev("tr:first-of-type")).get(0);if(s){if(n.safeBlur=!1,n.rowObject.direction="up",i=!0,e(t).is(".tabledrag-root")){for(o=0;s&&l.find(".js-indentation").length;)s=(l=e(s).prev("tr:first-of-type")).get(0),o+=l.is(":hidden")?0:s.offsetHeight;s&&(n.rowObject.swap("before",s),window.scrollBy(0,-o))}else(n.table.tBodies[0].rows[0]!==s||l.is(".draggable"))&&(n.rowObject.swap("before",s),n.rowObject.interval=null,n.rowObject.indent(0),window.scrollBy(0,-parseInt(t.offsetHeight,10)));a.trigger("focus")}break;case 39:case 63235:i=!0,n.rowObject.indent(n.rtl);break;case 40:case 63233:for(var d=e(n.rowObject.group).eq(-1).next("tr:first-of-type"),g=d.get(0);g&&d.is(":hidden");)g=(d=e(g).next("tr:first-of-type")).get(0);if(g){if(n.safeBlur=!1,n.rowObject.direction="down",i=!0,e(t).is(".tabledrag-root")){o=0;var c=new n.row(g,"keyboard",n.indentEnabled,n.maxDepth,!1);if(c){e(c.group).each(function(){o+=e(this).is(":hidden")?0:this.offsetHeight});var p=e(c.group).eq(-1).get(0);n.rowObject.swap("after",p),window.scrollBy(0,parseInt(o,10))}}else n.rowObject.swap("after",g),n.rowObject.interval=null,n.rowObject.indent(0),window.scrollBy(0,parseInt(t.offsetHeight,10));a.trigger("focus")}}if(n.rowObject&&!0===n.rowObject.changed&&(e(t).addClass("drag"),n.oldRowElement&&e(n.oldRowElement).removeClass("drag-previous"),n.oldRowElement=t,!0===n.striping&&n.restripeTable(),n.onDrag()),i)return!1}),a.on("keypress",function(e){switch(e.keyCode){case 37:case 38:case 39:case 40:return!1}})},Drupal.tableDrag.prototype.row.prototype.markChanged=function(){var t=e("td:first",this.element),n=e(t.find(".file-size").get(0)||t.find(".file").get(0)||t.find(".tabledrag-handle").get(0));t.find(".tabledrag-changed").length||n.after(" "+Drupal.theme("tableDragChangedMarker")+" ")},e.extend(Drupal.theme,{tableDragChangedMarker:function(){return'<span aria-hidden="true" data-icon-type="warning" class="tabledrag-changed text-warning icon glyphicon glyphicon-warning-sign icon-before"></span>'},tableDragChangedWarning:function(){return'<div class="tabledrag-changed-warning alert alert-sm alert-warning messages warning" style="clear: both;">'+Drupal.theme("tableDragChangedMarker")+" "+Drupal.t("You have unsaved changes.")+"</div>"}})}(jQuery);