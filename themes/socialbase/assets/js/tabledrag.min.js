!function(p){var e=Drupal.tableDrag.prototype;Drupal.tableDrag=function(e,t){var n=this,r=p(e);for(var a in this.$table=p(e),this.table=e,this.tableSettings=t,this.dragObject=null,this.rowObject=null,this.oldRowElement=null,this.oldY=0,this.changed=!1,this.maxDepth=0,this.rtl="rtl"===p(this.table).css("direction")?-1:1,this.striping=1===p(this.table).data("striping"),this.scrollSettings={amount:4,interval:50,trigger:70},this.scrollInterval=null,this.scrollY=0,this.windowHeight=0,this.indentEnabled=!1,t)if(t.hasOwnProperty(a))for(var o in t[a])t[a].hasOwnProperty(o)&&("parent"===t[a][o].relationship&&(this.indentEnabled=!0),0<t[a][o].limit&&(this.maxDepth=t[a][o].limit));if(this.indentEnabled){this.indentCount=1;var i=Drupal.theme("tableDragIndentation"),l=p("<tr/>").addClass("draggable").appendTo(e),s=p("<td/>").appendTo(l).prepend(i).prepend(i).find(".js-indentation");this.indentAmount=s.get(1).offsetLeft-s.get(0).offsetLeft,l.remove()}r.find("> tr.draggable, > tbody > tr.draggable").each(function(){n.makeDraggable(this)});var d=p(Drupal.theme("btn-sm",{class:["tabledrag-toggle-weight","btn-flat","pull-right","margin-bottom-l"],title:Drupal.t("Re-order rows by numerical weight instead of dragging."),"data-toggle":"tooltip"}));d.on("click",p.proxy(function(e){e.preventDefault(),this.toggleColumns()},this)).wrap('<div class="tabledrag-toggle-weight-wrapper"></div>').parent(),r.before(d),n.initColumns(),p(document).on("touchmove",function(e){return n.dragRow(e.originalEvent.touches[0],n)}),p(document).on("touchend",function(e){return n.dropRow(e.originalEvent.touches[0],n)}),p(document).on("mousemove pointermove",function(e){return n.dragRow(e,n)}),p(document).on("mouseup pointerup",function(e){return n.dropRow(e,n)}),p(window).on("storage",p.proxy(function(e){"Drupal.tableDrag.showWeight"===e.originalEvent.key&&(showWeight=JSON.parse(e.originalEvent.newValue),this.displayColumns(showWeight))},this))},Drupal.tableDrag.prototype=e,Drupal.tableDrag.prototype.makeDraggable=function(d){var g=this,e=p(d);e.find("td:first-of-type").find("a").addClass("menu-item__link");var c=p('<a href="#" class="tabledrag-handle icon-before"/>'),t=e.find("td:first-of-type").find(".js-indentation").eq(-1);t.length?(t.after(c),g.indentCount=Math.max(e.find(".js-indentation").length,g.indentCount)):e.find("td").eq(0).prepend(c),c.attr("title",Drupal.t("Drag to re-order")).attr("data-toggle","tooltip").attr("data-icon-type","open_with").append(Drupal.theme("bootstrapIcon","move")),c.on("mousedown touchstart pointerdown",function(e){e.preventDefault(),"touchstart"===e.originalEvent.type&&(e=e.originalEvent.touches[0]),g.dragStart(e,g,d)}),c.on("click",function(e){e.preventDefault()}),c.on("focus",function(){g.safeBlur=!0}),c.on("blur",function(e){g.rowObject&&g.safeBlur&&g.dropRow(e,g)}),c.on("keydown",function(e){9===e.keyCode||g.rowObject||(g.rowObject=new g.row(d,"keyboard",g.indentEnabled,g.maxDepth,!0));var t,n=!1;switch(e.keyCode){case 37:case 63234:n=!0,g.rowObject.indent(-1*g.rtl);break;case 38:case 63232:for(var r=p(g.rowObject.element).prev("tr:first-of-type"),a=r.get(0);a&&r.is(":hidden");)a=(r=p(a).prev("tr:first-of-type")).get(0);if(a){if(g.safeBlur=!1,g.rowObject.direction="up",n=!0,p(d).is(".tabledrag-root")){for(t=0;a&&r.find(".js-indentation").length;)a=(r=p(a).prev("tr:first-of-type")).get(0),t+=r.is(":hidden")?0:a.offsetHeight;a&&(g.rowObject.swap("before",a),window.scrollBy(0,-t))}else g.table.tBodies[0].rows[0]===a&&!r.is(".draggable")||(g.rowObject.swap("before",a),g.rowObject.interval=null,g.rowObject.indent(0),window.scrollBy(0,-parseInt(d.offsetHeight,10)));c.trigger("focus")}break;case 39:case 63235:n=!0,g.rowObject.indent(g.rtl);break;case 40:case 63233:for(var o=p(g.rowObject.group).eq(-1).next("tr:first-of-type"),i=o.get(0);i&&o.is(":hidden");)i=(o=p(i).next("tr:first-of-type")).get(0);if(i){if(g.safeBlur=!1,g.rowObject.direction="down",n=!0,p(d).is(".tabledrag-root")){t=0;var l=new g.row(i,"keyboard",g.indentEnabled,g.maxDepth,!1);if(l){p(l.group).each(function(){t+=p(this).is(":hidden")?0:this.offsetHeight});var s=p(l.group).eq(-1).get(0);g.rowObject.swap("after",s),window.scrollBy(0,parseInt(t,10))}}else g.rowObject.swap("after",i),g.rowObject.interval=null,g.rowObject.indent(0),window.scrollBy(0,parseInt(d.offsetHeight,10));c.trigger("focus")}}if(g.rowObject&&!0===g.rowObject.changed&&(p(d).addClass("drag"),g.oldRowElement&&p(g.oldRowElement).removeClass("drag-previous"),g.oldRowElement=d,!0===g.striping&&g.restripeTable(),g.onDrag()),n)return!1}),c.on("keypress",function(e){switch(e.keyCode){case 37:case 38:case 39:case 40:return!1}})},Drupal.tableDrag.prototype.row.prototype.markChanged=function(){var e=p("td:first",this.element),t=p(e.find(".file-size").get(0)||e.find(".file").get(0)||e.find(".tabledrag-handle").get(0));e.find(".tabledrag-changed").length||t.after(" "+Drupal.theme("tableDragChangedMarker")+" ")},p.extend(Drupal.theme,{tableDragChangedMarker:function(){return'<span aria-hidden="true" data-icon-type="warning" class="tabledrag-changed text-warning icon glyphicon glyphicon-warning-sign icon-before"></span>'},tableDragChangedWarning:function(){return'<div class="tabledrag-changed-warning alert alert-sm alert-warning messages warning" style="clear: both;">'+Drupal.theme("tableDragChangedMarker")+" "+Drupal.t("You have unsaved changes.")+"</div>"}})}(jQuery);