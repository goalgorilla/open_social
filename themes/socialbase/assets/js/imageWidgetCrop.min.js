!function(i,e,a){"use strict";var t=".crop-preview-wrapper__preview-image",r=null,p=".responsive-enabled",o={background:!1,zoomable:!1,viewMode:1,autoCropArea:1,responsive:!1,cropend:function(a){var t=i(this),r=t.siblings(".crop-preview-wrapper__value"),p=t.cropper("getData"),o=t.data("original-height")/t.prop("naturalHeight");r.find(".crop-x").val(Math.round(p.x*o)),r.find(".crop-y").val(Math.round(p.y*o)),r.find(".crop-width").val(Math.round(p.width*o)),r.find(".crop-height").val(Math.round(p.height*o)),r.find(".crop-applied").val(1),e.imageWidgetCrop.updateCropSummaries(t)}};e.imageWidgetCrop={},e.imageWidgetCrop.initialize=function(a){var r=i(".image-data__crop-wrapper",a),o=r.children(".details-wrapper").find("summary"),n=i(".vertical-tabs",a).find(".vertical-tab-button"),d=i(".crop-preview-wrapper__crop-reset",a);n.add(o).click(function(){var a=i(this).find("a").attr("href"),r=i(this).parent().find(t);void 0!==a&&(r=i(a).find(t));var p=e.imageWidgetCrop.getRatio(r);e.imageWidgetCrop.initializeCropper(r,p)}),r.children("summary").once("imageWidgetCrop").click(function(a){0!==n.length&&(i(this).parent().attr("open")?(a.preventDefault(),i(this).parent().attr("open",!1),i(p).removeClass("responsive-enabled--opened"),i(this).parent().find(".details-wrapper").hide()):(a.preventDefault(),i(this).parent().attr("open",!0),i(p).addClass("responsive-enabled--opened"),i(this).parent().find(".details-wrapper").show(),e.imageWidgetCrop.initializeCropperOnChildren(i(this).parent()),a.stopImmediatePropagation()))}),i(window).load(function(){e.imageWidgetCrop.initializeCropperAutomatically(i(".image-widget").next(".image-data__crop-wrapper"))}),i(document).ajaxSuccess(function(a,t,r){void 0!==r.extraData&&r.extraData.hasOwnProperty("_triggering_element_name")&&void 0!==i('button[name="'+r.extraData._triggering_element_name+'"]')&&(e.imageWidgetCrop.initializeCropperAutomatically(i(".image-widget").next(".image-data__crop-wrapper")),i(".image-data__crop-wrapper").each(function(){i(this).attr("open","open")}))}),d.on("click",function(a){a.preventDefault();var r=i(this).siblings(t);return e.imageWidgetCrop.reset(r),!1}),i(window).resize(function(){i(".image-widget-data").each(function(){i(this).children('details[open="open"]').each(function(){i(this).find(t).each(function(){var a=i(this);if("none"!==a.parent().parent().parent().css("display")){var t=a.cropper("getCanvasData"),r=a.cropper("getCropBoxData");a.cropper("render");var p=a.cropper("getCanvasData"),o=1;0!==t.width&&(o=p.width/t.width),i.each(r,function(i,e){r[i]=e*o}),a.cropper("setCropBoxData",r),e.imageWidgetCrop.updateHardLimits(a),e.imageWidgetCrop.checkSoftLimits(a),e.imageWidgetCrop.updateCropSummaries(a)}})})})}),e.imageWidgetCrop.updateAllCropSummaries()},e.imageWidgetCrop.getRatio=function(e){var a=e.data("ratio");if(null!==/:/.exec(a)){var t=a.split(":");return i.isArray(t)&&i.isNumeric(t[0])&&i.isNumeric(t[1])?t[0]/t[1]:"NaN"}return a},e.imageWidgetCrop.initializeCropper=function(t,p){var n=null,d=t.siblings(".crop-preview-wrapper__value"),g=t.data("original-width")/200;o.minContainerHeight=t.data("original-height")/g;var m=o,h=t.data("original-height")/t.prop("naturalHeight");m.autoCrop=a.crop_default,1===parseInt(d.find(".crop-applied").val())&&(n={x:Math.round(parseInt(d.find(".crop-x").val())/h),y:Math.round(parseInt(d.find(".crop-y").val())/h),width:Math.round(parseInt(d.find(".crop-width").val())/h),height:Math.round(parseInt(d.find(".crop-height").val())/h),rotate:0,scaleX:1,scaleY:1},m.autoCrop=!0),m.cropmove=function(a){e.imageWidgetCrop.checkSoftLimits(i(this))},m.data=n,m.aspectRatio=p,t.cropper(m),t.on("built.cropper",function(p){var o=i(this);e.imageWidgetCrop.updateHardLimits(o),e.imageWidgetCrop.checkSoftLimits(o);var n=o.next("div");if(null===r&&(r={width:n.width(),height:n.height()},e.imageWidgetCrop.initializeSecondaryCroppers(t)),a.crop_default){var g=t.cropper("getData"),m=t.data("original-height")/t.prop("naturalHeight");e.imageWidgetCrop.updateCropValues(d,g,m),e.imageWidgetCrop.updateCropSummaries(t)}})},e.imageWidgetCrop.updateCropValues=function(i,e,a){i.find(".crop-x").val(Math.round(e.x*a)),i.find(".crop-y").val(Math.round(e.y*a)),i.find(".crop-width").val(Math.round(e.width*a)),i.find(".crop-height").val(Math.round(e.height*a)),i.find(".crop-applied").val(1)},e.imageWidgetCrop.toCanvasDimensions=function(i,e,a){var t=i.data("cropper").getImageData();return{width:t.width*(e/i.data("original-width")),height:t.height*(a/i.data("original-height"))}},e.imageWidgetCrop.toImageDimensions=function(i,e,a){var t=i.data("cropper").getImageData();return{width:e*(i.data("original-width")/t.width),height:a*(i.data("original-height")/t.height)}},e.imageWidgetCrop.updateHardLimits=function(i){var t=i.data("name");if(a.image_widget_crop.hasOwnProperty(t)){var r=a.image_widget_crop[t],p=i.data("cropper"),o=p.options,n=e.imageWidgetCrop.toCanvasDimensions(i,r.hard_limit.width,r.hard_limit.height);o.minCropBoxWidth=n.width,o.minCropBoxHeight=n.height,p.limitCropBox(!0,!1)}},e.imageWidgetCrop.checkSoftLimits=function(i){var t=i.data("name");if(a.image_widget_crop.hasOwnProperty(t))for(var r=a.image_widget_crop[t],p={width:Number(r.soft_limit.width)||0,height:Number(r.soft_limit.height)||0},o=i.cropper("getCropBoxData"),n=e.imageWidgetCrop.toImageDimensions(i,o.width,o.height),d=["width","height"],g=0;g<d.length;++g){var m=i.data(d[g]+"-soft-limit-reached");n[d[g]]<p[d[g]]?m||(m=!0,e.imageWidgetCrop.softLimitChanged(i,d[g],m)):m&&(m=!1,e.imageWidgetCrop.softLimitChanged(i,d[g],m))}},e.imageWidgetCrop.softLimitChanged=function(i,a,t){var r=i.siblings(".cropper-container");t?r.addClass("cropper--"+a+"-soft-limit-reached"):r.removeClass("cropper--"+a+"-soft-limit-reached"),i.data(a+"-soft-limit-reached",t),e.imageWidgetCrop.updateSingleCropSummary(i)},e.imageWidgetCrop.initializeCropperOnChildren=function(a){var r=a.find(t+":visible"),p=e.imageWidgetCrop.getRatio(i(r));e.imageWidgetCrop.initializeCropper(i(r),p)},e.imageWidgetCrop.initializeCropperAutomatically=function(a){if(0!==a.length){var r=a.find(".in "+t),p=e.imageWidgetCrop.getRatio(i(r));e.imageWidgetCrop.initializeCropper(i(r),p)}},e.imageWidgetCrop.initializeSecondaryCroppers=function(a){var p=a.parent().parent().parent().siblings(".vertical-tabs-pane");i(p).each(function(a,p){var o=i(p).find(t);i(o).parent().width(r.width),i(o).parent().height(r.height);var n=e.imageWidgetCrop.getRatio(i(o));e.imageWidgetCrop.initializeCropper(i(o),n),i(o).parent("div").height("auto")})},e.imageWidgetCrop.updateSingleCropSummary=function(i){var a=i.siblings(".crop-preview-wrapper__value"),t=parseInt(a.find(".crop-applied").val()),r=[];i.closest("details").drupalSetSummary(function(a){return 1===t&&r.push(e.t("Cropping applied.")),(i.data("height-soft-limit-reached")||i.data("width-soft-limit-reached"))&&r.push(e.t("Soft limit reached.")),r.join("<br>")})},e.imageWidgetCrop.updateCommonCropSummary=function(i){var a=parseInt(i.find('.crop-applied[value="1"]').length),t=e.t("Crop image");a&&(t=e.t("Crop image (cropping applied)")),i.children("summary").text(t)},e.imageWidgetCrop.updateCropSummaries=function(i){var a=i.closest("details.image-data__crop-wrapper");e.imageWidgetCrop.updateSingleCropSummary(i),e.imageWidgetCrop.updateCommonCropSummary(a)},e.imageWidgetCrop.updateAllCropSummaries=function(){i(t).each(function(){e.imageWidgetCrop.updateSingleCropSummary(i(this))}),i(".image-data__crop-wrapper").each(function(){e.imageWidgetCrop.updateCommonCropSummary(i(this))})},e.imageWidgetCrop.reset=function(i){var t=i.siblings(".crop-preview-wrapper__value"),r=o;if(a.crop_default){i.cropper("reset").cropper("options",r);var p=i.cropper("getData"),n=i.data("original-height")/i.prop("naturalHeight");e.imageWidgetCrop.updateCropValues(t,p,n)}else i.cropper("destroy"),r.autoCrop=!1,i.cropper(r),t.find(".crop-applied").val(0),t.find(".crop-x").val(""),t.find(".crop-y").val(""),t.find(".crop-width").val(""),t.find(".crop-height").val("");e.imageWidgetCrop.updateCropSummaries(i)},e.behaviors.imageWidgetCrop={attach:function(i){e.imageWidgetCrop.initialize(i),e.imageWidgetCrop.updateAllCropSummaries()}}}(jQuery,Drupal,drupalSettings);