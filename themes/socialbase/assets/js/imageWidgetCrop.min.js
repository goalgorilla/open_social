!function(i,e,t){"use strict";var a=".crop-preview-wrapper__preview-image",r=".crop-preview-wrapper__value",o=".image-data__crop-wrapper",p="summary",n=".vertical-tabs",d=".vertical-tab-button",g=".crop-preview-wrapper__crop-reset",h=".details-wrapper",m=".image-widget-data",c=null,l=".responsive-enabled",s={background:!1,zoomable:!1,viewMode:1,autoCropArea:1,responsive:!1,cropend:function(t){var a=i(this),o=a.siblings(r),p=a.cropper("getData"),n=a.data("original-height")/a.prop("naturalHeight");o.find(".crop-x").val(Math.round(p.x*n)),o.find(".crop-y").val(Math.round(p.y*n)),o.find(".crop-width").val(Math.round(p.width*n)),o.find(".crop-height").val(Math.round(p.height*n)),o.find(".crop-applied").val(1),e.imageWidgetCrop.updateCropSummaries(a)}};e.imageWidgetCrop={},e.imageWidgetCrop.initialize=function(t){var r=i(o,t),c=r.children(h).find(p),s=i(n,t),u=s.find(d),C=i(g,t);u.add(c).click(function(){var t=i(this).find("a").attr("href"),r=i(this).parent().find(a);"undefined"!=typeof t&&(r=i(t).find(a));var o=e.imageWidgetCrop.getRatio(r);e.imageWidgetCrop.initializeCropper(r,o)}),r.children(p).once("imageWidgetCrop").click(function(t){0!==u.length&&(i(this).parent().attr("open")?(t.preventDefault(),i(this).parent().attr("open",!1),i(l).removeClass("responsive-enabled--opened"),i(this).parent().find(h).hide()):(t.preventDefault(),i(this).parent().attr("open",!0),i(l).addClass("responsive-enabled--opened"),i(this).parent().find(h).show(),e.imageWidgetCrop.initializeCropperOnChildren(i(this).parent()),t.stopImmediatePropagation()))}),i(window).load(function(){e.imageWidgetCrop.initializeCropperAutomatically(i(".image-widget").next(".image-data__crop-wrapper"))}),i(document).ajaxSuccess(function(t,a,r){if("undefined"!=typeof r.extraData&&r.extraData.hasOwnProperty("_triggering_element_name")&&"undefined"!=typeof i('button[name="'+r.extraData._triggering_element_name+'"]')){var p=e.imageWidgetCrop.initializeCropperAutomatically(i(".image-widget").next(".image-data__crop-wrapper"));console.log(p),i(o).each(function(){i(this).attr("open","open")})}}),C.on("click",function(t){t.preventDefault();var r=i(this).siblings(a);return e.imageWidgetCrop.reset(r),!1}),i(window).resize(function(){i(m).each(function(){var t=i(this).children('details[open="open"]');t.each(function(){var t=i(this).find(a);t.each(function(){var t=i(this);if("none"!==t.parent().parent().parent().css("display")){var a=t.cropper("getCanvasData"),r=t.cropper("getCropBoxData");t.cropper("render");var o=t.cropper("getCanvasData"),p=1;0!==a.width&&(p=o.width/a.width),i.each(r,function(i,e){r[i]=e*p}),t.cropper("setCropBoxData",r),e.imageWidgetCrop.updateHardLimits(t),e.imageWidgetCrop.checkSoftLimits(t),e.imageWidgetCrop.updateCropSummaries(t)}})})})}),e.imageWidgetCrop.updateAllCropSummaries()},e.imageWidgetCrop.getRatio=function(e){var t=e.data("ratio"),a=/:/;if(null!==a.exec(t)){var r=t.split(":");return i.isArray(r)&&i.isNumeric(r[0])&&i.isNumeric(r[1])?r[0]/r[1]:"NaN"}return t},e.imageWidgetCrop.initializeCropper=function(a,o){var p=null,n=a.siblings(r),d=a.data("original-width")/200;s.minContainerHeight=a.data("original-height")/d;var g=s,h=a.data("original-height")/a.prop("naturalHeight");g.autoCrop=t.crop_default,1===parseInt(n.find(".crop-applied").val())&&(p={x:Math.round(parseInt(n.find(".crop-x").val())/h),y:Math.round(parseInt(n.find(".crop-y").val())/h),width:Math.round(parseInt(n.find(".crop-width").val())/h),height:Math.round(parseInt(n.find(".crop-height").val())/h),rotate:0,scaleX:1,scaleY:1},g.autoCrop=!0),g.cropmove=function(t){e.imageWidgetCrop.checkSoftLimits(i(this))},g.data=p,g.aspectRatio=o,a.cropper(g),a.on("built.cropper",function(r){var o=i(this);e.imageWidgetCrop.updateHardLimits(o),e.imageWidgetCrop.checkSoftLimits(o);var p=o.next("div");if(null===c&&(c={width:p.width(),height:p.height()},e.imageWidgetCrop.initializeSecondaryCroppers(a)),t.crop_default){var d=a.cropper("getData"),g=a.data("original-height")/a.prop("naturalHeight");e.imageWidgetCrop.updateCropValues(n,d,g),e.imageWidgetCrop.updateCropSummaries(a)}})},e.imageWidgetCrop.updateCropValues=function(i,e,t){i.find(".crop-x").val(Math.round(e.x*t)),i.find(".crop-y").val(Math.round(e.y*t)),i.find(".crop-width").val(Math.round(e.width*t)),i.find(".crop-height").val(Math.round(e.height*t)),i.find(".crop-applied").val(1)},e.imageWidgetCrop.toCanvasDimensions=function(i,e,t){var a=i.data("cropper").getImageData();return{width:a.width*(e/i.data("original-width")),height:a.height*(t/i.data("original-height"))}},e.imageWidgetCrop.toImageDimensions=function(i,e,t){var a=i.data("cropper").getImageData();return{width:e*(i.data("original-width")/a.width),height:t*(i.data("original-height")/a.height)}},e.imageWidgetCrop.updateHardLimits=function(i){var a=i.data("name");if(t.image_widget_crop.hasOwnProperty(a)){var r=t.image_widget_crop[a],o=i.data("cropper"),p=o.options,n=e.imageWidgetCrop.toCanvasDimensions(i,r.hard_limit.width,r.hard_limit.height);p.minCropBoxWidth=n.width,p.minCropBoxHeight=n.height,o.limitCropBox(!0,!1)}},e.imageWidgetCrop.checkSoftLimits=function(i){var a=i.data("name");if(t.image_widget_crop.hasOwnProperty(a))for(var r=t.image_widget_crop[a],o={width:Number(r.soft_limit.width)||0,height:Number(r.soft_limit.height)||0},p=i.cropper("getCropBoxData"),n=e.imageWidgetCrop.toImageDimensions(i,p.width,p.height),d=["width","height"],g=0;g<d.length;++g){var h=i.data(d[g]+"-soft-limit-reached");n[d[g]]<o[d[g]]?h||(h=!0,e.imageWidgetCrop.softLimitChanged(i,d[g],h)):h&&(h=!1,e.imageWidgetCrop.softLimitChanged(i,d[g],h))}},e.imageWidgetCrop.softLimitChanged=function(i,t,a){var r=i.siblings(".cropper-container");a?r.addClass("cropper--"+t+"-soft-limit-reached"):r.removeClass("cropper--"+t+"-soft-limit-reached"),i.data(t+"-soft-limit-reached",a),e.imageWidgetCrop.updateSingleCropSummary(i)},e.imageWidgetCrop.initializeCropperOnChildren=function(t){var r=t.find(a+":visible"),o=e.imageWidgetCrop.getRatio(i(r));e.imageWidgetCrop.initializeCropper(i(r),o)},e.imageWidgetCrop.initializeCropperAutomatically=function(t){if(0!==t.length){var r=t.find(".in "+a),o=e.imageWidgetCrop.getRatio(i(r));e.imageWidgetCrop.initializeCropper(i(r),o)}},e.imageWidgetCrop.initializeSecondaryCroppers=function(t){var r=t.parent().parent().parent().siblings(".vertical-tabs-pane"),o=i(r);o.each(function(t,r){var o=i(r).find(a);i(o).parent().width(c.width),i(o).parent().height(c.height);var p=e.imageWidgetCrop.getRatio(i(o));e.imageWidgetCrop.initializeCropper(i(o),p),i(o).parent("div").height("auto")})},e.imageWidgetCrop.updateSingleCropSummary=function(i){var t=i.siblings(r),a=parseInt(t.find(".crop-applied").val()),o=[];i.closest("details").drupalSetSummary(function(t){return 1===a&&o.push(e.t("Cropping applied.")),(i.data("height-soft-limit-reached")||i.data("width-soft-limit-reached"))&&o.push(e.t("Soft limit reached.")),o.join("<br>")})},e.imageWidgetCrop.updateCommonCropSummary=function(i){var t=parseInt(i.find('.crop-applied[value="1"]').length),a=e.t("Crop image");t&&(a=e.t("Crop image (cropping applied)")),i.children("summary").text(a)},e.imageWidgetCrop.updateCropSummaries=function(i){var t=i.closest("details"+o);e.imageWidgetCrop.updateSingleCropSummary(i),e.imageWidgetCrop.updateCommonCropSummary(t)},e.imageWidgetCrop.updateAllCropSummaries=function(){var t=i(a);t.each(function(){e.imageWidgetCrop.updateSingleCropSummary(i(this))});var r=i(o);r.each(function(){e.imageWidgetCrop.updateCommonCropSummary(i(this))})},e.imageWidgetCrop.reset=function(i){var a=i.siblings(r),o=s;if(t.crop_default){i.cropper("reset").cropper("options",o);var p=i.cropper("getData"),n=i.data("original-height")/i.prop("naturalHeight");e.imageWidgetCrop.updateCropValues(a,p,n)}else i.cropper("destroy"),o.autoCrop=!1,i.cropper(o),a.find(".crop-applied").val(0),a.find(".crop-x").val(""),a.find(".crop-y").val(""),a.find(".crop-width").val(""),a.find(".crop-height").val("");e.imageWidgetCrop.updateCropSummaries(i)},e.behaviors.imageWidgetCrop={attach:function(i){e.imageWidgetCrop.initialize(i),e.imageWidgetCrop.updateAllCropSummaries()}}}(jQuery,Drupal,drupalSettings);